<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Parkway â€¢ Parking Map</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

<style>
/* ----- YOUR ORIGINAL UI, UNCHANGED ----- */
:root{
  --bg1:#0f2027; --bg2:#203a43; --bg3:#2c5364;
  --free:#24ff6d; --reserved:#ffd056; --occupied:#ff5252;
}

/* (UI code omitted here on purpose â€” keep yours exactly same) */
</style>
</head>

<body>

<header class="topbar">
  <div class="brand"><a href="index.html">ðŸš— Parkway</a></div>
  <nav class="navlinks">
    <a href="index.html">Home</a>
    <a href="map.html">Parking Map</a>
    <a href="booking.html">My Booking</a>
    <a href="dashboard.html">Dashboard</a>
    <a href="about.html">How It Works</a>
    <a href="contact.html">Contact</a>
  </nav>
</header>

<main class="container">
  <section class="panel">

    <div class="panel-head">
      <h2>Live Parking Map</h2>
      <div class="legend">
        <span class="dot free"></span> Free
        <span class="dot reserved" style="margin-left:12px"></span> Reserved
        <span class="dot occupied" style="margin-left:12px"></span> Occupied
      </div>
    </div>

    <!-- YOUR LOT GRID EXACTLY SAME -->
    <div class="lot-grid">
      <!-- Aâ€“D rows exactly same â€” keep your UI -->
    </div>

  </section>
</main>

<script>
/* ========================= */
/*      BACKEND API LINK     */
/* ========================= */
const API_URL = "/api/parking";

/* ========================= */
/* NORMALIZE SERVER STATUS   */
/* ========================= */
function normalizeStatus(s) {
  const st = String(s || "").trim().toUpperCase();
  if (st === "FREE" || st === "EMPTY") return "FREE";
  if (st === "RESERVED") return "RESERVED";
  if (st === "OCCUPIED") return "OCCUPIED";
  return "FREE";
}

/* ================================================= */
/* WHEN USER CLICKS A SLOT (BOOK FROM MAP PAGE)     */
/* ================================================= */
function onSlotClick(slotId) {

  const confirmReserve = confirm(`Do you want to reserve ${slotId}?`);
  if (!confirmReserve) return;

  fetch(`${API_URL}/${slotId}`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ status: "RESERVED" })
  })
  .then(res => res.json())
  .then(d => {

    console.log("BOOKED:", d);

    /* SAVE BOOKING FOR BOOKING PAGE */
    localStorage.setItem("reservedSlot", slotId);
    localStorage.setItem("reservedUntil", Date.now() + 20 * 60000);

    alert(`${slotId} reserved!`);
  })
  .catch(err => console.error("ERR booking:", err));
}

/* ===================================== */
/* LIVE UPDATE PARKING MAP EVERY 2 SEC   */
/* ===================================== */
let isFetching = false;

async function fetchSlots() {
  if (isFetching) return;
  isFetching = true;

  try {
    const res = await fetch(API_URL, { cache: "no-store" });
    if (!res.ok) return;
    const data = await res.json();

    Object.keys(data).forEach(id => {

      const el = document.getElementById(id);
      if (!el) return;

      const st = normalizeStatus(data[id]);

      /* APPLY COLORS */
      el.classList.remove("free", "reserved", "occupied");
      if (st === "FREE") el.classList.add("free");
      if (st === "RESERVED") el.classList.add("reserved");
      if (st === "OCCUPIED") el.classList.add("occupied");

      /* MAKE CLICKABLE */
      el.onclick = () => onSlotClick(id);
    });

  } catch (err) {
    console.error(err);
  }

  isFetching = false;
}

document.addEventListener("DOMContentLoaded", () => {
  fetchSlots();
  setInterval(fetchSlots, 2000);
});
</script>

</body>
</html>




