<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Parkway â€¢ Parking Map</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<style>
/* -------- YOUR EXISTING MAP UI (unchanged) -------- */
:root{
  --bg1:#0f2027; --bg2:#203a43; --bg3:#2c5364;
  --free:#24ff6d; --reserved:#ffd056; --occupied:#ff5252;
}

/* YOUR EXISTING CSS unchanged */
body{margin:0;font-family:Poppins;background:linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3)) fixed;color:#fff}
.slot.free{border-color:var(--free)} .slot.reserved{border-color:var(--reserved)} .slot.occupied{border-color:var(--occupied)}
/* (Your full CSS stays as-isâ€¦ I'm not repeating all of it here for space) */

/* -------- MODAL POPUP -------- */
#modal {
  position: fixed;
  top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.55);
  display:flex; justify-content:center; align-items:center;
  z-index:1000; visibility:hidden; opacity:0;
  transition: 0.2s ease;
}
#modal.show {
  visibility:visible; opacity:1;
}
.modal-box {
  background:#0f2027;
  padding:20px;
  border-radius:10px;
  width:300px;
  text-align:center;
  box-shadow:0 10px 40px rgba(0,0,0,0.5);
}
button {
  margin:8px; padding:10px 18px; border:none; border-radius:6px;
  cursor:pointer; font-weight:600;
}
.btn-confirm { background:#ffd056; color:#000; }
.btn-cancel { background:#444; color:#fff; }
</style>
</head>

<body>
<header class="topbar">
  <div class="brand"><a href="index.html">ðŸš— Parkway</a></div>
</header>

<!-- ========================================================= -->
<!--  YOUR PARKING GRID (unchanged)                           -->
<!-- ========================================================= -->
<!-- (I am keeping your original map exactly the same) -->

<!-- MODAL POPUP -->
<div id="modal">
  <div class="modal-box">
    <h3 id="modalTitle">Reserve Slot</h3>
    <p id="modalText">Confirm?</p>
    <button class="btn-confirm" id="confirmBtn">Confirm</button>
    <button class="btn-cancel" id="cancelBtn">Cancel</button>
  </div>
</div>

<script>
/* ============================================================
   BACKEND URL
============================================================ */
const API = "https://parkway-8fji.onrender.com/api/parking";

/* ============================================================
   OPEN MODAL WHEN YOU CLICK A SLOT
============================================================ */
let selectedSlot = null;

document.querySelectorAll(".slot").forEach(slot => {
  slot.addEventListener("click", () => {
    selectedSlot = slot.id;
    document.getElementById("modalTitle").innerText = "Reserve Slot";
    document.getElementById("modalText").innerHTML =
      `Do you want to reserve <strong>${selectedSlot}</strong>?`;

    openModal();
  });
});

/* ============================================================
   MODAL CONTROLS
============================================================ */
const modal = document.getElementById("modal");

function openModal() { modal.classList.add("show"); }
function closeModal() { modal.classList.remove("show"); }

document.getElementById("cancelBtn").onclick = closeModal;

/* ============================================================
   CONFIRM RESERVATION BUTTON
============================================================ */
document.getElementById("confirmBtn").onclick = async () => {
  if (!selectedSlot) return;

  // Send reservation request
  const res = await fetch(`${API}/${selectedSlot}`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ status:"RESERVED", durationMinutes:20 })
  });

  if (res.ok) {
    console.log("Slot reserved:", selectedSlot);
    closeModal();
    fetchSlots();  // refresh UI
  } else {
    alert("Failed to reserve. Check server.");
  }
};

/* ============================================================
   LIVE UPDATER (shows yellow/red/green)
============================================================ */
async function fetchSlots() {
  const res = await fetch(API);
  if (!res.ok) return;

  const data = await res.json();

  Object.keys(data).forEach(id => {
    const slotEl = document.getElementById(id);
    if (!slotEl) return;

    slotEl.classList.remove("free","reserved","occupied");

    if (data[id] === "EMPTY") slotEl.classList.add("free");
    if (data[id] === "RESERVED") slotEl.classList.add("reserved");
    if (data[id] === "OCCUPIED") slotEl.classList.add("occupied");
  });
}

fetchSlots();
setInterval(fetchSlots, 2000);
</script>
</body>
</html>
