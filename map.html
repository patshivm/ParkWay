<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Parkway â€¢ Parking Map</title>
<link rel="stylesheet" href="style.css">
<style>
  .map-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    max-width: 400px;
    margin: 1rem auto;
  }
  .slot {
    position: relative;
    padding: 1rem;
    border-radius: 8px;
    font-weight: bold;
    text-align: center;
    color: white;
    user-select: none;
  }
  .free { background-color: #28a745; }
  .occupied { background-color: #dc3545; }
  .unknown { background-color: #ffc107; color: #212529; }
  .slot-number { display: block; font-size: 1.2rem; }
  .badge { display: block; margin-top: 0.25rem; font-size: 0.8rem; font-weight: normal; }
</style>
</head>
<body>
<header class="topbar">
  <div class="brand"><a href="index.html">ðŸš— Parkway</a></div>
  <nav class="navlinks">
    <a href="index.html">Home</a>
    <a href="map.html">Parking Map</a>
    <a href="booking.html">My Booking</a>
    <a href="dashboard.html">Dashboard</a>
    <a href="about.html">How It Works</a>
    <a href="contact.html">Contact</a>
  </nav>
</header>

<main class="container">
  <section class="panel glass">
    <div class="panel-head">
      <h2>Live Parking Map</h2>
      <div class="legend">
        <span class="dot free"></span> Free &nbsp;
        <span class="dot occupied"></span> Occupied &nbsp;
        <span class="dot unknown"></span> Unknown &nbsp;
      </div>
    </div>

    <div class="map-grid" role="region" aria-label="Parking lot map">
      <div class="slot free" id="A1"><span class="slot-number">A1</span></div>
      <div class="slot free" id="A2"><span class="slot-number">A2</span></div>
      <div class="slot free" id="A3"><span class="slot-number">A3</span></div>
      <div class="slot free" id="A4"><span class="slot-number">A4</span></div>
      <div class="slot free" id="B1"><span class="slot-number">B1</span></div>
      <div class="slot free" id="B2"><span class="slot-number">B2</span></div>
      <div class="slot free" id="B3"><span class="slot-number">B3</span></div>
      <div class="slot free" id="B4"><span class="slot-number">B4</span></div>
    </div>

    <p class="mini-note">
      Slots update based on ESP32 sensor data. Green = Free, Red = Occupied, Yellow = Unknown.
    </p>
  </section>
</main>

<script>
const serverURL = "/api/parking";

async function fetchSlots() {
  try {
    const res = await fetch(serverURL);
    if (!res.ok) throw new Error("Network response not OK");
    const data = await res.json();
    updateMap(data);
  } catch (err) {
    console.error("Fetch error:", err);
  }
}

function updateMap(slots) {
  for (const id in slots) {
    const el = document.getElementById(id);
    if (!el) continue;

    el.classList.remove("free", "occupied", "unknown");

    const status = slots[id];
    if (status === "EMPTY") el.classList.add("free");
    else if (status === "OCCUPIED") el.classList.add("occupied");
    else el.classList.add("UNKNOWN");

    el.innerHTML = `<span class="slot-number">${id}</span>
                    <span class="badge ${el.classList[0]}">${status}</span>`;
  }
}

// Fetch every second
setInterval(fetchSlots, 1000);
fetchSlots();
</script>

</body>
</html>