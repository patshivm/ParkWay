<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Parkway â€¢ Parking Map</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg1:#0f2027; --bg2:#203a43; --bg3:#2c5364;
  --asphalt: #2b2b2b;
  --asphalt-dark: #1f1f1f;
  --slot-border: #ffd700;
  --road-width: 120px;
  --hroad-height: 72px;
  --gutter: 22px;

  --free: #24ff6d;
  --reserved: #ffd056;
  --occupied: #ff5252;
}

*{box-sizing:border-box;}
html,body{height:100%;margin:0;padding:0}
body{
  margin:0;
  font-family:"Poppins",sans-serif;
  color:#fff;
  background: linear-gradient(135deg, var(--bg1), var(--bg2), var(--bg3)) fixed;
}

header.topbar{
  background:rgba(0,0,0,0.28);
  padding:.6rem 1.75rem;
  display:flex;
  align-items:center;
  justify-content:space-between;
  backdrop-filter: blur(6px);
  border-bottom:1px solid rgba(255,255,255,0.06);
}
header.topbar a{color:#70afbb;text-decoration:none;margin-left:.6rem}

.container{
  max-width:1400px;
  margin:1.75rem auto;
  padding:0 1rem;
}

.panel{
  background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
  border-radius:10px;
  padding:1rem;
  box-shadow:0 10px 40px rgba(0,0,0,0.35);
  border:1px solid rgba(255,255,255,0.04);
}

.panel-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.legend{font-size:0.92rem}
.legend .dot{display:inline-block;width:12px;height:12px;border-radius:50%;margin-right:6px;vertical-align:middle}
.legend .free{background:var(--free)} .legend .reserved{background:var(--reserved)} .legend .occupied{background:var(--occupied)}

.lot-grid{
  display:grid;
  grid-template-columns: 1fr var(--road-width) 1fr;
  grid-template-rows: auto var(--hroad-height) auto var(--hroad-height) auto;
  gap: var(--gutter);
  position:relative;
  padding:28px;
  border-radius:8px;
  background: linear-gradient(180deg, rgba(0,0,0,0.18), rgba(0,0,0,0.12));
  border:1px solid rgba(255,255,255,0.03);
}

.vertical-road{
  grid-column:2 / 3;
  grid-row:1 / 6;
  background: linear-gradient(180deg, var(--asphalt-dark), rgba(0,0,0,0.6));
  border-radius:8px;
  position:relative;
}

.hroad{
  grid-column:1 / 4;
  height:var(--hroad-height);
  background: linear-gradient(90deg, var(--asphalt-dark), rgba(0,0,0,0.6));
  border-radius:6px;
}

.band{display:flex;flex-direction:column;gap:14px;padding:6px 6px;}
.park-row{display:flex;gap:8px;align-items:center;}

.slot{
  width:64px;height:96px;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.25));
  border:2px solid rgba(255,255,255,0.06);
  border-radius:6px;
  color:#fff;font-weight:700;
  display:flex;align-items:flex-end;justify-content:flex-end;
  cursor:pointer;
}
.slot-number{font-size:.65rem;opacity:0.95;padding:6px 8px;background:rgba(0,0,0,0.25);border-radius:4px;}

.slot.free{border-color:var(--free);}
.slot.reserved{border-color:var(--reserved);}
.slot.occupied{border-color:var(--occupied);}

/* Popup */
.hidden{display:none;}
#reserveModal{
  position:fixed;left:0;top:0;width:100%;height:100%;
  background:rgba(0,0,0,0.45);
  display:flex;align-items:center;justify-content:center;
  z-index:999;
}
#reserveBox{
  background:white;color:black;padding:20px;border-radius:10px;
  min-width:260px;max-width:320px;
}
</style>
</head>

<body>

<header class="topbar">
  <div class="brand"><a href="index.html">ðŸš— Parkway</a></div>
  <nav class="navlinks">
    <a href="index.html">Home</a>
    <a href="map.html">Parking Map</a>
    <a href="booking.html">My Booking</a>
    <a href="dashboard.html">Dashboard</a>
    <a href="about.html">How It Works</a>
    <a href="contact.html">Contact</a>
  </nav>
</header>

<main class="container">
  <section class="panel">
    <div class="panel-head">
      <h2>Live Parking Map</h2>
      <div class="legend">
        <span class="dot free"></span> Free
        <span class="dot reserved" style="margin-left:12px"></span> Reserved
        <span class="dot occupied" style="margin-left:12px"></span> Occupied
      </div>
    </div>

    <!-- PARKING GRID -->
    <div class="lot-grid">
      <div class="vertical-road"></div>

      <!-- A -->
      <div class="band" style="grid-column:1;grid-row:1;">
        <div class="park-row">
          <div class="slot free" id="A1"><span class="slot-number">A1</span></div>
          <div class="slot free" id="A2"><span class="slot-number">A2</span></div>
          <div class="slot free" id="A3"><span class="slot-number">A3</span></div>
          <div class="slot free" id="A4"><span class="slot-number">A4</span></div>
          <div class="slot free" id="A5"><span class="slot-number">A5</span></div>
        </div>
      </div>

      <!-- B -->
      <div class="band" style="grid-column:3;grid-row:1;">
        <div class="park-row">
          <div class="slot free" id="B1"><span class="slot-number">B1</span></div>
          <div class="slot free" id="B2"><span class="slot-number">B2</span></div>
          <div class="slot free" id="B3"><span class="slot-number">B3</span></div>
          <div class="slot free" id="B4"><span class="slot-number">B4</span></div>
          <div class="slot free" id="B5"><span class="slot-number">B5</span></div>
        </div>
      </div>

      <!-- C -->
      <div class="band" style="grid-column:1;grid-row:3;">
        <div class="park-row">
          <div class="slot free" id="C1"><span class="slot-number">C1</span></div>
          <div class="slot free" id="C2"><span class="slot-number">C2</span></div>
          <div class="slot free" id="C3"><span class="slot-number">C3</span></div>
          <div class="slot free" id="C4"><span class="slot-number">C4</span></div>
          <div class="slot free" id="C5"><span class="slot-number">C5</span></div>
        </div>
      </div>

      <!-- D -->
      <div class="band" style="grid-column:3;grid-row:3;">
        <div class="park-row">
          <div class="slot free" id="D1"><span class="slot-number">D1</span></div>
          <div class="slot free" id="D2"><span class="slot-number">D2</span></div>
          <div class="slot free" id="D3"><span class="slot-number">D3</span></div>
          <div class="slot free" id="D4"><span class="slot-number">D4</span></div>
          <div class="slot free" id="D5"><span class="slot-number">D5</span></div>
        </div>
      </div>

      <div class="hroad" style="grid-column:1/4;grid-row:2;"></div>
      <div class="hroad" style="grid-column:1/4;grid-row:4;"></div>

    </div>
  </section>
</main>

<!-- RESERVATION POPUP -->
<div id="reserveModal" class="hidden">
  <div id="reserveBox">
    <h3 id="modalTitle">Reserve Slot</h3>
    <p id="modalText">Do you want to reserve?</p>

    <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:14px;">
      <button id="cancelBtn">Cancel</button>
      <button id="confirmBtn" style="background:#2c5364;color:white;border:none;padding:6px 12px;border-radius:6px;">
        Confirm
      </button>
    </div>
  </div>
</div>

<script>
const API_URL = "https://parkway-8fji.onrender.com/api/parking";

let selectedSlot = null;
let fetching = false;

/* Normalize backend state */
function normalizeStatus(s) {
  const st = String(s || "").toUpperCase();
  if (st === "EMPTY" || st === "FREE") return "FREE";
  if (st === "RESERVED") return "RESERVED";
  if (st === "OCCUPIED") return "OCCUPIED";
  return "FREE";
}

/* Fetch & update slot colors */
async function fetchSlots() {
  if (fetching) return;
  fetching = true;
  try {
    const res = await fetch(API_URL);
    const data = await res.json();
    Object.keys(data).forEach(id => {
      const slotEl = document.getElementById(id);
      if (!slotEl) return;
      const status = normalizeStatus(data[id]);
      slotEl.classList.remove("free","reserved","occupied");
      slotEl.classList.add(status.toLowerCase());

      /* Add click handler */
      slotEl.onclick = () => {
        if (status === "OCCUPIED") return;
        selectedSlot = id;
        document.getElementById("modalTitle").textContent = "Reserve Slot";
        document.getElementById("modalText").innerHTML =
          `Do you want to reserve <strong>${id}</strong>?`;
        document.getElementById("reserveModal").classList.remove("hidden");
      };
    });
  } catch (e) { console.error(e); }
  fetching = false;
}

/* Cancel */
document.getElementById("cancelBtn").onclick = () =>
  document.getElementById("reserveModal").classList.add("hidden");

/* Confirm reservation */
document.getElementById("confirmBtn").onclick = async () => {
  await fetch(`${API_URL}/${selectedSlot}`, {
    method: "POST",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify({ status:"RESERVED", durationMinutes:20 })
  });
  document.getElementById("reserveModal").classList.add("hidden");
  fetchSlots();
};

/* Start live updates */
fetchSlots();
setInterval(fetchSlots, 2000);
</script>

</body>
</html>
