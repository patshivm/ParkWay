<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Parkway â€¢ Parking Map</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --asphalt: #2b2b2b;
  --asphalt-dark: #1f1f1f;
  --slot-border: #ffd700; /* yellow lines */
  --road-width: 120px;
  --hroad-height: 72px;
  --gutter: 22px;
}

*{box-sizing:border-box;}
body{
  margin:0;
  font-family:"Poppins",sans-serif;
  background:var(--asphalt);
  color:#fff;
}

header.topbar{
  background:#222;
  padding:.6rem 1.75rem;
  display:flex;
  align-items:center;
  justify-content:space-between;
}
header.topbar a{color:#70afbb;text-decoration:none;margin-left:.6rem}

.container{
  max-width:1400px;
  margin:1.75rem auto;
  padding:0 1rem;
}

.panel{
  background:var(--asphalt-dark);
  border-radius:10px;
  padding:1rem;
  box-shadow:0 6px 20px rgba(0,0,0,0.08);
}

.panel-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.legend{font-size:0.92rem}
.legend .dot{display:inline-block;width:12px;height:12px;border-radius:50%;margin-right:6px;vertical-align:middle}
.free{background:#4CAF50}.occupied{background:#F44336}.unknown{background:#FFD700}

.lot-grid{
  display:grid;
  grid-template-columns: 1fr var(--road-width) 1fr;
  grid-template-rows: auto var(--hroad-height) auto var(--hroad-height) auto;
  gap: var(--gutter);
  position:relative;
  padding:28px;
  border-radius:8px;
  background: var(--asphalt);
}

/* Roads */
.vertical-road{
  grid-column:2 / 3;
  grid-row:1 / 6;
  background: var(--asphalt-dark);
  border-radius:8px;
  position:relative;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:2;
}
.vertical-road::after{
  content:"";
  position:absolute;
  left:50%;
  top:0;
  transform:translateX(-50%);
  width:6px;
  height:100%;
  background-image: repeating-linear-gradient(
    to bottom,
    #fff 0 18px,
    transparent 18px 36px
  );
  opacity:0.8;
}
.hroad{
  grid-column:1 / 4;
  height:var(--hroad-height);
  background: var(--asphalt-dark);
  position:relative;
  border-radius:6px;
  z-index:2;
}
.hroad::before{
  content:"";
  position:absolute;
  left:0;
  top:50%;
  transform:translateY(-50%);
  height:6px;
  width:100%;
  background-image: repeating-linear-gradient(
    to right,
    #fff 0 24px,
    transparent 24px 48px
  );
}

/* Parking Slots */
.band{
  display:flex;
  flex-direction:column;
  gap:14px;
  padding:6px 6px;
}
.park-row{
  display:flex;
  gap:8px;
  align-items:center;
  justify-content:flex-start;
}
.slot{
  width:64px;
  height:96px;
  background:var(--asphalt-dark);
  border:2px solid var(--slot-border);
  border-radius:4px;
  color:#fff;
  font-weight:700;
  display:flex;
  align-items:flex-end;
  justify-content:flex-end;
  position:relative;
  z-index:3;
}
.slot-number{
  font-size:.65rem;
  opacity:0.95;
  padding:2px 4px;
}

/* Slot Colors (dynamic) */
.slot.free{border-color:#4CAF50}
.slot.occupied{border-color:#F44336}
.slot.unknown{border-color:#FFD700}

/* Entrance & Exit Labels */
.entrance, .exit{
  position:absolute;
  padding:6px 10px;
  border-radius:6px;
  font-weight:700;
  z-index:5;
}
.entrance{top:-20px; left:50%; transform:translateX(-50%); background:#4CAF50;}
.exit{bottom:-20px; left:50%; transform:translateX(-50%); background:#F44336;}

@media (max-width:900px){
  .lot-grid{grid-template-columns: 1fr 96px 1fr; padding:18px}
  .slot{width:52px;height:82px}
}
</style>
</head>
<body>
<header class="topbar">
  <div class="brand"><a href="index.html">ðŸš— Parkway</a></div>
  <nav class="navlinks">
    <a href="index.html">Home</a>
    <a href="map.html">Parking Map</a>
    <a href="booking.html">My Booking</a>
    <a href="dashboard.html">Dashboard</a>
    <a href="about.html">How It Works</a>
    <a href="contact.html">Contact</a>
  </nav>
</header>

<main class="container">
  <section class="panel">
    <div class="panel-head">
      <h2>Live Parking Map</h2>
      <div class="legend">
        <span class="dot free"></span> Free
        <span class="dot occupied"></span> Occupied
        <span class="dot unknown"></span> Unknown
      </div>
    </div>

    <div class="lot-grid" role="region" aria-label="Parking lot map">
      <div class="vertical-road"></div>

      <!-- Bands: Aâ€“D with 5 slots each -->
      <div class="band" style="grid-column:1 / 2; grid-row:1 / 2;">
        <div class="park-row">
          <div class="slot free" id="A1"><span class="slot-number">A1</span></div>
          <div class="slot free" id="A2"><span class="slot-number">A2</span></div>
          <div class="slot free" id="A3"><span class="slot-number">A3</span></div>
          <div class="slot free" id="A4"><span class="slot-number">A4</span></div>
          <div class="slot free" id="A5"><span class="slot-number">A5</span></div>
        </div>
      </div>

      <div class="band" style="grid-column:3 / 4; grid-row:1 / 2;">
        <div class="park-row">
          <div class="slot free" id="B1"><span class="slot-number">B1</span></div>
          <div class="slot free" id="B2"><span class="slot-number">B2</span></div>
          <div class="slot free" id="B3"><span class="slot-number">B3</span></div>
          <div class="slot free" id="B4"><span class="slot-number">B4</span></div>
          <div class="slot free" id="B5"><span class="slot-number">B5</span></div>
        </div>
      </div>

      <div class="band" style="grid-column:1 / 2; grid-row:3 / 4;">
        <div class="park-row">
          <div class="slot free" id="C1"><span class="slot-number">C1</span></div>
          <div class="slot free" id="C2"><span class="slot-number">C2</span></div>
          <div class="slot free" id="C3"><span class="slot-number">C3</span></div>
          <div class="slot free" id="C4"><span class="slot-number">C4</span></div>
          <div class="slot free" id="C5"><span class="slot-number">C5</span></div>
        </div>
      </div>

      <div class="band" style="grid-column:3 / 4; grid-row:3 / 4;">
        <div class="park-row">
          <div class="slot free" id="D1"><span class="slot-number">D1</span></div>
          <div class="slot free" id="D2"><span class="slot-number">D2</span></div>
          <div class="slot free" id="D3"><span class="slot-number">D3</span></div>
          <div class="slot free" id="D4"><span class="slot-number">D4</span></div>
          <div class="slot free" id="D5"><span class="slot-number">D5</span></div>
        </div>
      </div>

      <div class="hroad" style="grid-column:1 / 4; grid-row:2 / 3;"></div>
      <div class="hroad" style="grid-column:1 / 4; grid-row:4 / 5;"></div>

      <div class="entrance">ENTRANCE</div>
      <div class="exit">EXIT</div>
    </div>
  </section>
</main>

<script>
let fetching = false;
async function fetchSlots() {
  if(fetching) return;
  fetching = true;
  try {
    const res = await fetch("/api/parking");
    const data = await res.json();
    for (const id in data) {
      const slotEl = document.getElementById(id);
      if(slotEl){
        slotEl.classList.remove("free","occupied","unknown");
        if(data[id] === "EMPTY") slotEl.classList.add("free");
        else if(data[id] === "OCCUPIED") slotEl.classList.add("occupied");
        else slotEl.classList.add("unknown");
      }
    }
  } catch(err) {
    console.error(err);
  } finally {
    fetching = false;
  }
}

// Update every 500ms
setInterval(fetchSlots, 500);
fetchSlots();
</script>
</body>
</html>
